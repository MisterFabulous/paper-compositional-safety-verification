\documentclass{beamer}

\mode<presentation> {

% The Beamer class comes with a number of default slide themes
% which change the colors and layouts of slides. Below this is a list
% of all the themes, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
%\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
%\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

% As well as themes, the Beamer class has a number of color themes
% for any slide theme. Uncomment each of these in turn to see how it
% changes the colors of your current slide theme.

%\usecolortheme{albatross}
%\usecolortheme{beaver}
%\usecolortheme{beetle}
%\usecolortheme{crane}
%\usecolortheme{dolphin}
%\usecolortheme{dove}
%\usecolortheme{fly}
%\usecolortheme{lily}
%\usecolortheme{orchid}
%\usecolortheme{rose}
%\usecolortheme{seagull}
%\usecolortheme{seahorse}
%\usecolortheme{whale}
%\usecolortheme{wolverine}

%\setbeamertemplate{footline} % To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}[page number] % To replace the footer line in all slides with a simple slide count uncomment this line

%\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides uncomment this line
}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
% \usepackage[ngerman]{babel}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{float}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

\let\oldReturn\Return
\renewcommand{\Return}{\State\oldReturn}

\usepackage{tikz}
\usetikzlibrary{arrows,decorations.pathmorphing,positioning,fit,trees,shapes,automata}
\usepackage{pgf-umlsd}
\usepgflibrary{arrows} % for pgf-umlsd

\tikzset{onslide/.code args={<#1>#2}{%
  \only<#1>{\pgfkeysalso{#2}} % \pgfkeysalso doesn't change the path
}}

\usepackage{listings}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[Compositional safety verification]{On Compositional safety verification with Max-SMT} % The short title appears at the bottom of every slide, the full title is only on the title page

\author{Fabian B\"{o}ller with David Korzeniewski} % Your name
\institute[i2] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
RWTH Aachen \\ % Your institution for the title page
\medskip
\textit{fabian.boeller@rwth-aachen.de} % Your email address
}
\date{SS 2017} % Date, can be changed to a custom date

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
\frametitle{Overview} % Table of contents slide, comment this block out to remove it
\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

\section{Introduction}

\begin{frame}
  \frametitle{Terms}
  \begin{block}{Safety verification}
    Prove that an assertion is \emph{always} true at a location
  \end{block}
  \pause
  \begin{block}{Non-compositional safety verification}
    Safety verification where the whole program is analyzed in one step
  \end{block}
  \pause
  \begin{block}{Compositional safety verification}
    Safety verification where program parts are analyzed semi-independently and composed
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Motivation}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=3cm,thick]
      \node (1) {Scalability};
      \node (2) [right of=1] {Loss in precision};
      \path[<->]
      (1) edge node {} (2);
    \end{tikzpicture}
  \end{figure}
\end{frame}

\section{Preliminaries}

\begin{frame}
  \frametitle{Programs}
  \begin{block}{Program}
    $\mathcal{L} = \lbrace \ell_0, \ell_1, \ell_2 \rbrace$
    \only<2->{, $\mathcal{T} = \lbrace t_i \mid i \in \lbrace 1,\dots,6 \rbrace \rbrace$}
    \only<3->{, $\mathcal{V} = \lbrace x,y,i \rbrace$, $\mathcal{V}' = \lbrace x',y',i' \rbrace$}
  \end{block}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->,>=stealth',auto,node distance=3cm,
        thick,
        main node/.style={circle,draw,font=\sffamily\Large\bfseries},
        aligned edge/.style={align=left},
        scc0/.style={draw=orange, text=orange},
        scc1/.style={draw=green, text=green},
        scc2/.style={draw=blue, text=blue}]

      \node[main node, onslide={<5->scc0}] (0) {$l_0$};
      \node[main node, onslide={<5->scc1}] (1) [right of=0] {$l_1$};
      \node[main node, onslide={<5->scc2}] (2) [right of=1] {$l_2$};
      
      \node (4) [right of=2] {};
      \node (5) [left of=0] {};

      \only<2->{
        \path[every node/.style={font=\sffamily\small}]
        (0) edge[aligned edge] node {$t_1$\only<3->{$: x \geq y$}} (1)
        (0) edge[aligned edge, bend right=25] node [below] {$t_2$\only<3->{$: y > x$}} (2)
        (1) edge[aligned edge, loop above, onslide={<6->scc1}] node {$t_3$\only<3->{$:$\\$i > 0 \wedge$\\$x' = x + 1 \wedge$\\$i' = i - 1$}} (1)
        (1) edge[aligned edge] node {$t_4$\only<3->{$: i = 0$}} (2)
        (2) edge[aligned edge, loop above, onslide={<6->scc2}] node {$t_5$\only<3->{$:$\\$x' = x + 1 \wedge$\\$y' = y + 1$}} (2)
        (2) edge[aligned edge] node {$t_6$\only<4->{, assert($x \neq y$)}} (4)
        (5) edge[aligned edge] node {$t_0$\only<3->{$: i > 0$}} (0);
      }
    \end{tikzpicture}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Algorithms}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->, >=stealth',shorten >=1pt,auto,node distance=1.5cm,thick]  
      \node (1) {CheckSafe};
      \node (2) [below left of=1] {CondSafe};
      \node (3) [below right of=1] {Narrowing};
      \path
      (1) edge [loop above] node {} (1)
          edge node {} (2)
          edge node {} (3);
    \end{tikzpicture}
  \end{figure}
  \pause
  \begin{block}{CheckSafe}
    Prove that an assertion is satisfied by backtracking through all entry components
  \end{block}
  \pause
  \begin{block}{CondSafe}
    Find a precondition for a component such that all runs satisfying the precondition always imply the postcondition
  \end{block}
  \pause
  \begin{block}{Narrowing}
    Manipulate the program such that new preconditions can be found
  \end{block}  
\end{frame}

\section{Example execution}

\begin{frame}
  \frametitle{Example program}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->,>=stealth',auto,node distance=3cm,
        thick,
        main node/.style={circle,draw,font=\sffamily\Large\bfseries},
        aligned edge/.style={align=left}]
      
      \node[main node] (0) {$l_0$};
      \node[main node] (1) [right of=0] {$l_1$};
      \node[main node] (2) [right of=1] {$l_2$};
      
      \node (4) [right of=2] {};
      \node (5) [left of=0] {};
      
      \path[every node/.style={font=\sffamily\small}]
      (0) edge[aligned edge] node {$t_1: x \geq y$} (1)
      edge[aligned edge, bend right=25] node [below] {$t_2: y > x$} (2)
      (1) edge[aligned edge, loop above] node {$t_3:$\\$i > 0 \wedge$\\$x' = x + 1 \wedge$\\$i' = i - 1$} (1)
      edge[aligned edge] node {$t_4: i = 0$} (2)
      (2) edge[aligned edge, loop above] node {$t_5:$\\$x' = x + 1 \wedge$\\$y' = y + 1$} (2)
      edge[aligned edge] node {$t_6$, assert($x \neq y$)} (4)
      (5) edge[aligned edge] node {$t_0: i > 0$} (0);
    \end{tikzpicture}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Example execution}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->,>=stealth',auto,node distance=3cm,
        thick,
        main node/.style={circle,draw,font=\sffamily\Large\bfseries},
        aligned edge/.style={align=left},
        inspect/.style={draw=blue, text=blue},
        safe/.style={draw=green, text=green},
        maybe/.style={draw=orange, text=orange},
        maxsmt/.style={draw=red, text=red}]
      
      \node[main node, onslide={<9>inspect}, onslide={<12-14>inspect}, onslide={<15>safe}, onslide={<16>inspect}, onslide={<17>safe}, onslide={<21>inspect}] (0) {$l_0$};
      \node[main node, onslide={<11-17>inspect}, onslide={<18>safe}] (1) [right of=0] {$l_1$};
      \node[main node, onslide={<2-22>inspect}, onslide={<23>safe}] (2) [right of=1] {$l_2$};
      
      \node (4) [right of=2] {};
      \node (5) [left of=0] {};
      
      \path[every node/.style={font=\sffamily\small}]
      (0) edge[aligned edge, onslide={<12-14>inspect}, onslide={<15>safe}, onslide={<16>inspect}, onslide={<17>safe}] node {$t_1: x \geq y$} (1)
      edge[aligned edge, bend right=25, onslide={<4,8>maxsmt}, onslide={<9>inspect}, onslide={<10-18>maybe}, onslide={<21>inspect}, onslide={<22>safe}] node [below] {$t_2: y > x$\\\only<13->{$\wedge \mathbf{x \leq y}$}} (2)
      (1) edge[aligned edge, loop above, onslide={<11-16>inspect}, onslide={<18>safe}] node {$t_3:$\\$i > 0 \wedge$\\$x' = x + 1 \wedge$\\$i' = i - 1$} (1)
      edge[aligned edge, onslide={<5,8>maxsmt}, onslide={<11-17>inspect}, onslide={<18>safe}, onslide={<21-22>safe}] node {$t_4: i = 0$} (2)
      (2) edge[aligned edge, loop above, onslide={<6,8>maxsmt}, onslide={<2-5,7,9-22>inspect}, onslide={<23>safe}] node {$t_5:$\\$x' = x + 1 \wedge$\\$y' = y + 1$\\\only<13->{$\wedge \mathbf{x \leq y}$}} (2)
      edge[aligned edge, onslide={<7,8>maxsmt}, onslide={<1-6,9-22>inspect}, onslide={<23>safe}] node {$t_6$, assert($x \neq y$)} (4)
      (5) edge[aligned edge, onslide={<13>inspect}, onslide={<14>safe}] node {$t_0: i > 0$} (0);
    \end{tikzpicture}
  \end{figure}

  \only<1>{
    \begin{block}{Task}
      Prove that the program is safe for $x \neq y$ at $t_6$
    \end{block}
  }

  \only<2>{
    \begin{block}{CheckSafe on $\lbrace \ell_2 \rbrace$ for $x \neq y$}
      $t_6$ does not already imply $x \neq y$\\
      $t_6$ is not an initial transition\\
      Call CondSafe
    \end{block}    
  }

  \only<3-8>{
    \begin{block}{Max-SMT on $\lbrace \ell_2 \rbrace$ for $x \neq y$}
      \only<3-7>{$I_{\ell_2,1}(\lbrace x, y, i \rbrace) \equiv i_{\ell_2,1} + i_{\ell_2,1,x} * x + i_{\ell_2,1,y} * y + i_{\ell_2,1,i} * i \leq 0$}\only<4-7>{\\}
      \only<4>{$\mathbb{I}_{t_2, 1, 1} \equiv y > x \wedge i' = i \wedge x' = x \wedge y' = y \Rightarrow I'_{\ell_2,1,1}$}
      \only<5>{$\mathbb{I}_{t_4, 1, 1} \equiv i = 0 \wedge i' = i \wedge x' = x \wedge y' = y \Rightarrow I'_{\ell_2,1,1}$}
      \only<6>{$\mathbb{C}_{t_5, 1} \equiv I_{\ell_2,1} \wedge x' = x + 1 \wedge y' = y + 1 \wedge i' = i \Rightarrow I'_{\ell_2,1}$}
      \only<7>{$\mathbb{S}_1 \equiv I_{\ell_2,1} \wedge i' = i \wedge x' = x \wedge y' = y \Rightarrow x' \neq y'$}
      \only<8>{
        $\mathbb{F}_1 \equiv \mathbb{C}_{t_5, 1} \wedge \mathbb{S}_1 \wedge ((\mathbb{I}_{t_2,1,1} \vee \neg p_{\mathbb{I}_{t_2,1,1}}) \wedge (\mathbb{I}_{t_4,1,1} \vee \neg p_{\mathbb{I}_{t_4,1,1}})) \wedge ([p_{\mathbb{I}_{t_2,1,1}}, \omega_\mathbb{I}] \wedge [p_{\mathbb{I}_{t_4,1,1}}, \omega_\mathbb{I}])$\\
        Assume $x > y$ does satisfy $\mathbb{F}_1$
      }
    \end{block}
  }

  \only<9>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x > y$}
      $t_2$ does not already imply $x > y$\\
      $t_2$ is not an initial transition\\
      Call CondSafe
    \end{block}    
  }

  \only<10>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x > y$}
      No precondition, since $y > x$ contradicts $x > y$\\
      Path is maybe safe, but not for $x > y$
    \end{block}    
  }

  \only<11>{
    \begin{block}{CheckSafe on $\lbrace \ell_1 \rbrace$ for $x > y$}
      $t_4$ does not already imply $x > y$\\
      $t_4$ is not an initial transition\\
      Call CondSafe, get $i > 0 \wedge x \geq y$ as precondition
    \end{block}    
  }

  \only<12>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $i > 0$}
      $t_1$ does not already imply $i > 0$\\
      $t_1$ is not an initial transition\\
      Call CondSafe, get $i > 0$ as precondition
    \end{block}    
  }

  \only<13>{
    \begin{block}{CheckSafe on initial SCC for $i > 0$}
      $t_0$ does already imply $i > 0$
    \end{block}    
  }

  \only<14>{
    \begin{block}{CheckSafe on initial SCC for $i > 0$}
      Path is safe for $i > 0$
    \end{block}    
  }

  \only<15>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $i > 0$}
      Path is safe for $i > 0$
    \end{block}    
  }

  \only<16>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x \geq y$}
      $t_1$ does already imply $x \geq y$
    \end{block}    
  }

  \only<17>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x \geq y$}
      Path is safe for $x \geq y$
    \end{block}    
  }

  \only<18>{
    \begin{block}{CheckSafe on $\lbrace \ell_1 \rbrace$ for $x > y$}
      Path is safe for $x > y$
    \end{block}    
  }

  \only<19>{
    \begin{block}{Narrow on $\lbrace \ell_2 \rbrace$}
      Add $x \leq y$ to $t_2$\\
      Add $x \leq y$ to $t_5$
    \end{block}    
  }

  \only<20>{
    \begin{block}{CheckSafe on $\lbrace \ell_2 \rbrace$ for $x \neq y$}
      Call CondSafe, get $y > x$ instead of $x > y$ as precondition
    \end{block}    
  }

  \only<21>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $y > x$}
      $t_2$ does already imply $y > x$
    \end{block}    
  }

  \only<22>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $y > x$}
      Path is safe for $y > x$
    \end{block}    
  }

  \only<23>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $y > x$}
      Program is safe for $x \neq y$
    \end{block}    
  }

\end{frame}

\section{Conclusion}

\begin{frame}
  \frametitle{Conclusion}
  \begin{block}{We saw:}
    \begin{enumerate}
    \item The exploration of multiple entry SCCs by CheckSafe
    \item The effect of narrowing if a path to the SCC is proved safe and another could not be proved safe
    \item The behavior of CheckSafe if a CII with multiple conjunctions is found
    \end{enumerate}
  \end{block}
  \begin{block}{We didn't saw:}
    \begin{enumerate}
    \item SCCs with multiple transitions (effects consecution conditions in Max-SMT and entry locations in Narrowing)
    \end{enumerate}
  \end{block}
\end{frame}

%----------------------------------------------------------------------------------------
%	END OF PRESENTATION SLIDES
%----------------------------------------------------------------------------------------
\begin{frame}
\frametitle{References}
\footnotesize{
\begin{thebibliography}{99} % Beamer does not support BibTeX so references must be inserted manually as below
\bibitem[Brockschmidt, Larraz, Oliveras, Rodriguez-Carbonell, Rubio, 2015]{p1} Brockschmidt, Marc and Larraz, Daniel and Oliveras, Albert and Rodriguez-Carbonell, Enric and Rubio, Albert (2015)
\newblock Compositional Safety Verification with Max-SMT
\newblock \emph{Proceedings of FMCAD'15}
\end{thebibliography}
}
\end{frame}

%------------------------------------------------

\begin{frame}
\Huge{\centerline{The End}}
\end{frame}

%----------------------------------------------------------------------------------------

\end{document} 
