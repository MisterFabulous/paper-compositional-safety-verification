\documentclass{beamer}

\mode<presentation> {

% The Beamer class comes with a number of default slide themes
% which change the colors and layouts of slides. Below this is a list
% of all the themes, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
%\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
%\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

% As well as themes, the Beamer class has a number of color themes
% for any slide theme. Uncomment each of these in turn to see how it
% changes the colors of your current slide theme.

%\usecolortheme{albatross}
%\usecolortheme{beaver}
%\usecolortheme{beetle}
%\usecolortheme{crane}
%\usecolortheme{dolphin}
%\usecolortheme{dove}
%\usecolortheme{fly}
%\usecolortheme{lily}
%\usecolortheme{orchid}
%\usecolortheme{rose}
%\usecolortheme{seagull}
%\usecolortheme{seahorse}
%\usecolortheme{whale}
%\usecolortheme{wolverine}

%\setbeamertemplate{footline} % To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}[page number] % To replace the footer line in all slides with a simple slide count uncomment this line

%\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides uncomment this line
}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
% \usepackage[ngerman]{babel}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{float}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

\let\oldReturn\Return
\renewcommand{\Return}{\State\oldReturn}

\usepackage{tikz}
\usetikzlibrary{arrows,decorations.pathmorphing,positioning,fit,trees,shapes,automata}
\usepackage{pgf-umlsd}
\usepgflibrary{arrows} % for pgf-umlsd

\tikzset{onslide/.code args={<#1>#2}{%
  \only<#1>{\pgfkeysalso{#2}} % \pgfkeysalso doesn't change the path
}}

\usepackage{listings}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[Compositional safety verification]{On Compositional safety verification with Max-SMT} % The short title appears at the bottom of every slide, the full title is only on the title page

\author{Fabian B\"{o}ller with David Korzeniewski} % Your name
\institute[i2] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
RWTH Aachen \\ % Your institution for the title page
\medskip
\textit{fabian.boeller@rwth-aachen.de} % Your email address
}
\date{SS 2017} % Date, can be changed to a custom date

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

\begin{frame}
\frametitle{Overview} % Table of contents slide, comment this block out to remove it
\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

\section{Example execution}

\begin{frame}
  \frametitle{CheckSafe}
    \begin{algorithmic}[1]
      \State Input: The program, an SCC, the entry transitions of the SCC, an exit transition with an assertion
      \pause
      \If {the exit transition already implies the assertion}
      \Return Safe
      \pause
      \ElsIf {the exit transition is an initial transition}
      \Return Maybe
      \EndIf
      \pause
      \State Call CondSafe for the SCC with the given assertion
      \pause
      \If {no CII could be found}
      \Return Maybe
      \EndIf
      \pause
      \ForAll {entry SCCs}
      \ForAll {literals of the according condition of the CII}
      \State Call CheckSafe for the entry SCC and with the literal as assertion
      \EndFor
      \EndFor
      \pause
      \If {all calls returned Safe}
      \Return Safe
      \EndIf
      \pause
      \Return the result of a call to CheckSafe with a narrowed version
    \end{algorithmic}
\end{frame}

\begin{frame}
  \frametitle{CondSafe}
  \begin{algorithmic}[1]
    \State Input: An SCC, the entry transitions of the SCC, an exit transition with an assertion
    \pause
    \State $k \gets 1$
    \pause
    \Repeat
    \State Construct a formula $\mathbb{F}_k$ for the SCC and the assertion
    \pause
    \State Call the Max-SMT-Solver with $\mathbb{F}_k$
    \pause
    \If {it returned a solution}
    \Return an invariant assigning each location the according condition from $\mathbb{F}_k$
    \EndIf
    \pause
    \State $k \gets k + 1$
    \Until{$k > \text{MAX\_CONJUNCTS}$}
    \pause
    \Return None
  \end{algorithmic}
\end{frame}

\begin{frame}
  \frametitle{Narrowing}
  \begin{algorithmic}[1]
    \State Input: An SCC, the entry transitions of the SCC, a CII
    \pause
    \ForAll {entry transitions}
    \ForAll {literals of the CII}
    \pause
    \If {literal could not be proved safe for this transition}
    \State Add a conjunct with the negated literal to the transition
    \EndIf
    \EndFor
    \EndFor
    \pause
    \ForAll {transitions of the SCC}
    \pause
    \State Add a conjunct with the negated CII at the start location to the transition
    \pause
    \State Add a conjunct with the negated CII at the end location to the transition
    \EndFor
\end{algorithmic}

\end{frame}

\begin{frame}
  \frametitle{Example program}
  \begin{block}{Program}
    $\mathcal{V} = \lbrace x,y,i \rbrace$, $\mathcal{L} = \lbrace \ell_0, \ell_1, \ell_2 \rbrace$, $\mathcal{T} = \lbrace t_i \mid i \in \lbrace 1,\dots,6 \rbrace \rbrace$
  \end{block}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->,>=stealth',auto,node distance=3cm,
        thick,
        main node/.style={circle,draw,font=\sffamily\Large\bfseries},
        aligned edge/.style={align=left}]
      
      \node[main node] (0) {$l_0$};
      \node[main node] (1) [right of=0] {$l_1$};
      \node[main node] (2) [right of=1] {$l_2$};
      
      \node (4) [right of=2] {};
      \node (5) [left of=0] {};
      
      \path[every node/.style={font=\sffamily\small}]
      (0) edge[aligned edge] node {$t_1: x \geq y$} (1)
      edge[aligned edge, bend right=25] node [below] {$t_2: y > x$} (2)
      (1) edge[aligned edge, loop above] node {$t_3:$\\$i > 0 \wedge$\\$x' = x + 1 \wedge$\\$i' = i - 1$} (1)
      edge[aligned edge] node {$t_4: i = 0$} (2)
      (2) edge[aligned edge, loop above] node {$t_5:$\\$x' = x + 1 \wedge$\\$y' = y + 1$} (2)
      edge[aligned edge] node {$t_6$, assert($x \neq y$)} (4)
      (5) edge[aligned edge] node {$t_0: i > 0$} (0);
    \end{tikzpicture}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Example execution}
  \begin{figure}
    \centering
    \begin{tikzpicture}[->,>=stealth',auto,node distance=3cm,
        thick,
        main node/.style={circle,draw,font=\sffamily\Large\bfseries},
        aligned edge/.style={align=left},
        inspect/.style={draw=blue, text=blue},
        safe/.style={draw=green, text=green},
        maybe/.style={draw=orange, text=orange}]
      
      \node[main node, onslide={<3>inspect}, onslide={<6-8>inspect}, onslide={<9>safe}, onslide={<10>inspect}, onslide={<11>safe}, onslide={<15>inspect}] (0) {$l_0$};
      \node[main node, onslide={<5-11>inspect}, onslide={<12>safe}] (1) [right of=0] {$l_1$};
      \node[main node, onslide={<2-16>inspect}, onslide={<17>safe}] (2) [right of=1] {$l_2$};
      
      \node (4) [right of=2] {};
      \node (5) [left of=0] {};
      
      \path[every node/.style={font=\sffamily\small}]
      (0) edge[aligned edge, onslide={<6-8>inspect}, onslide={<9>safe}, onslide={<10>inspect}, onslide={<11>safe}] node {$t_1: x \geq y$} (1)
      edge[aligned edge, bend right=25, onslide={<3>inspect}, onslide={<4-12>maybe}, onslide={<15>inspect}, onslide={<16>safe}] node [below] {$t_2: y > x$\\\only<13->{$\wedge \mathbf{x \leq y}$}} (2)
      (1) edge[aligned edge, loop above, onslide={<5-10>inspect}, onslide={<12>safe}] node {$t_3:$\\$i > 0 \wedge$\\$x' = x + 1 \wedge$\\$i' = i - 1$} (1)
      edge[aligned edge, onslide={<5-11>inspect}, onslide={<12>safe}, onslide={<15-16>safe}] node {$t_4: i = 0$} (2)
      (2) edge[aligned edge, loop above, onslide={<2-16>inspect}, onslide={<17>safe}] node {$t_5:$\\$x' = x + 1 \wedge$\\$y' = y + 1$\\\only<13->{$\wedge \mathbf{x \leq y}$}} (2)
      edge[aligned edge, onslide={<1-16>inspect}, onslide={<17>safe}] node {$t_6$, assert($x \neq y$)} (4)
      (5) edge[aligned edge, onslide={<7>inspect}, onslide={<8>safe}] node {$t_0: i > 0$} (0);
    \end{tikzpicture}
  \end{figure}

  \only<1>{
    \begin{block}{Task}
      Prove that the program is safe for $x \neq y$ at $t_6$
    \end{block}
  }

  \only<2>{
    \begin{block}{CheckSafe on $\lbrace \ell_2 \rbrace$ for $x \neq y$}
      $t_6$ does not already imply $x \neq y$\\
      $t_6$ is not an initial transition\\
      Call CondSafe, get $x > y$ as precondition
    \end{block}    
  }

  \only<3>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x > y$}
      $t_2$ does not already imply $x > y$\\
      $t_2$ is not an initial transition\\
      Call CondSafe
    \end{block}    
  }

  \only<4>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x > y$}
      No precondition, since $y > x$ contradicts $x > y$\\
      Path is maybe safe, but not for $x > y$
    \end{block}    
  }

  \only<5>{
    \begin{block}{CheckSafe on $\lbrace \ell_1 \rbrace$ for $x > y$}
      $t_4$ does not already imply $x > y$\\
      $t_4$ is not an initial transition\\
      Call CondSafe, get $i > 0 \wedge x \geq y$ as precondition
    \end{block}    
  }

  \only<6>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $i > 0$}
      $t_1$ does not already imply $i > 0$\\
      $t_1$ is not an initial transition\\
      Call CondSafe, get $i > 0$ as precondition
    \end{block}    
  }

  \only<7>{
    \begin{block}{CheckSafe on initial SCC for $i > 0$}
      $t_0$ does already imply $i > 0$
    \end{block}    
  }

  \only<8>{
    \begin{block}{CheckSafe on initial SCC for $i > 0$}
      Path is safe for $i > 0$
    \end{block}    
  }

  \only<9>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $i > 0$}
      Path is safe for $i > 0$
    \end{block}    
  }

  \only<10>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x \geq y$}
      $t_1$ does already imply $x \geq y$
    \end{block}    
  }

  \only<11>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $x \geq y$}
      Path is safe for $x \geq y$
    \end{block}    
  }

  \only<12>{
    \begin{block}{CheckSafe on $\lbrace \ell_1 \rbrace$ for $x > y$}
      Path is safe for $x > y$
    \end{block}    
  }

  \only<13>{
    \begin{block}{Narrow on $\lbrace \ell_2 \rbrace$}
      Add $x \leq y$ to $t_2$\\
      Add $x \leq y$ to $t_5$
    \end{block}    
  }

  \only<14>{
    \begin{block}{CheckSafe on $\lbrace \ell_2 \rbrace$ for $x \neq y$}
      Call CondSafe, get $y > x$ instead of $x > y$ as precondition
    \end{block}    
  }

  \only<15>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $y > x$}
      $t_2$ does already imply $y > x$
    \end{block}    
  }

  \only<16>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $y > x$}
      Path is safe for $y > x$
    \end{block}    
  }

  \only<17>{
    \begin{block}{CheckSafe on $\lbrace \ell_0 \rbrace$ for $y > x$}
      Program is safe for $x \neq y$
    \end{block}    
  }

\end{frame}

%----------------------------------------------------------------------------------------
%	END OF PRESENTATION SLIDES
%----------------------------------------------------------------------------------------
\begin{frame}
\frametitle{References}
\footnotesize{
\begin{thebibliography}{99} % Beamer does not support BibTeX so references must be inserted manually as below
\bibitem[Brockschmidt, Larraz, Oliveras, Rodriguez-Carbonell, Rubio, 2015]{p1} Brockschmidt, Marc and Larraz, Daniel and Oliveras, Albert and Rodriguez-Carbonell, Enric and Rubio, Albert (2015)
\newblock Compositional Safety Verification with Max-SMT
\newblock \emph{Proceedings of FMCAD'15}
\end{thebibliography}
}
\end{frame}

%------------------------------------------------

\begin{frame}
\Huge{\centerline{The End}}
\end{frame}

%----------------------------------------------------------------------------------------

\end{document} 
